<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <title>尼泊尔地震变化检测</title>

    <script src="js/jquery.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="css/ol.css" type="text/css">
    <script src="js/ol.js"></script>

    <link href="css/offcanvas.css" rel="stylesheet">

    <style>

        #layertree li > span {
            cursor: pointer;
        }

        .map {
            height: 100%;
            width: 100%;
        }

        .ah {
            height: 100%;
        }

        .hh {
            height: 50%;
        }
		
		.nopadding {
			padding: 0;
		}
		
    </style>
</head>
<body>

<div class="row ah">
    <div class="col-md-2 ah">
	<h1>尼泊尔地震变化检测</h1>
	<p>
		左上是2015年4月11日地震之前GF1拍摄的影像；右上是2015年4月27日地震之后GF1拍摄的影像；<br/>
		左下是两个时相切换的动画；右下是变化检查工具的彩色示意图，颜色深的是变化大的区域。<br/>
		<br/>
		变化检测不是一件容易的事情，除了云的干扰以外，因为拍摄角度和太阳角度的不同导致显示高楼的不同侧面以及阴影都会干扰电脑的识别，所以目前还是需要人的智力来辨识图像变化的实质意义。<br/>
		
	</p>
	</div>
    <div class="col-md-5 ah nopadding">
		<div id="map1" class="map hh"></div>
		<div id="map3" class="map hh"></div>
	</div>
    <div class="col-md-5 ah nopadding">
		<div id="map2" class="map hh"></div>
		<div id="map4" class="map hh"></div>
	</div>
	</div>
</div>

<script>
    var extent = [0, 0, 1960, 1960];
    var projection = new ol.proj.Projection({
        code: 'xkcd-image',
        units: 'pixels',
        extent: extent
    });

    source1 = new ol.source.ImageStatic({
        attributions: [
            new ol.Attribution({
                html: '【4月11日 地震前】'
            })
        ],
        url: 'http://novachen.github.io/images/e0411.jpg',
        projection: projection,
        imageExtent: extent
    });

    source2 = new ol.source.ImageStatic({
        attributions: [
            new ol.Attribution({
                html: '【4月27日 地震后】'
            })
        ],
        url: 'http://novachen.github.io/images/e0427.jpg',
        projection: projection,
        imageExtent: extent
    });


	sourceChange = new ol.source.ImageStatic({
        attributions: [
            new ol.Attribution({
                html: '【变化检测】'
            })
        ],
        url: 'http://novachen.github.io/images/change.jpg',
        projection: projection,
        imageExtent: extent
    });
	
	
    layer1 = new ol.layer.Image({
        source: source1
    });

    layer2 = new ol.layer.Image({
        source: source2
    });

    layer10 = new ol.layer.Image({
        source: source1
    });

    layer20 = new ol.layer.Image({
        source: source2
    });

    layerChange = new ol.layer.Image({
        source: sourceChange
    });

	view = new ol.View({
        projection: projection,
        center: ol.extent.getCenter(extent),
        zoom: 3
    });

    var map1 = new ol.Map({
        layers: [
            new ol.layer.Group({
                layers: [
                    layer10
                ]

            })
        ],
        renderer: 'canvas',
        target: 'map1',
        view: view
    });

    var map2 = new ol.Map({
        layers: [
            new ol.layer.Group({
                layers: [
                    layer20
                ]

            })
        ],
        renderer: 'canvas',
        target: 'map2',
        view: view
    });

    var map3 = new ol.Map({
        layers: [
            new ol.layer.Group({
                layers: [
                    layer1,
                    layer2
                ]

            })
        ],
        renderer: 'canvas',
        target: 'map3',
        view: view
    });


    var map4 = new ol.Map({
        layers: [
            new ol.layer.Group({
                layers: [
                    layerChange
                ]

            })
        ],
        renderer: 'canvas',
        target: 'map4',
        view: view
    });

	layer1.setVisible(true);
	layer2.setVisible(false);

    setInterval('flickImage()', 1000);

    function flickImage() {
        layer1.setVisible(!layer1.getVisible());
        layer2.setVisible(!layer2.getVisible());
    }

</script>
</body>
</html>