<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
	<meta name="viewport" content="user-scalable=no">

    <title>高分二号配准融合效果比较</title>

    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.5.0/ol.css" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.5.0/ol.js"></script>

    <link href="css/offcanvas.css" rel="stylesheet">

    <style>

        #layertree li > span {
            cursor: pointer;
        }

        .map {
            height: 100%;
            width: 100%;
        }
		
        .scrolly {
            overflow-y: auto;
        }
        .ah {
            height: 100%;
        }

        .hh {
            height: 50%;
        }
		
		
		.nopadding {
			padding: 0;
		}
		
		.story {
		z-index:100;
		position:absolute;
		left:30px;
		top:30px;
		width:350px;
		bottom:20px;
		overflow-y: auto;
		background:#FFF;
		filter:alpha(Opacity=70);-moz-opacity:0.7;opacity: 0.7;
		}
		
		.bigtext {
			font-size: 2em;
		}
		
    </style>
</head>
<body>
<div class="row ah">
    <div class="col-md-2 ah">
    <button id="switchFlipBtn">按这个按钮来选择是否切换显示</button>
	
<h1>高分二号配准融合效果比较</h1>
</br>

<p>
高分二号是目前我国分辨率最高的民用对地观测卫星，垂直星下点成像时的分辨率达到0.8米。国家积极推进高分专项的应用工程，鼓励卫星用户积极使用卫星数据，以免费或者低价的方式把数据分发给用户。</br></br>
但是每颗国产卫星都有它特定的结构特点，已有的常用遥感软件比如ENVI\PCI等都主要针对国外的卫星设计，因此在应对国产卫星数据的时候很难有好的处理效果。</br></br>
GF2上有PAN和MS两个传感器，为了得到最终的图像产品，需要对两个传感器实施配准和融合。</br></br>
让第三方人士利用常用遥感软件ENVI上的多种工具和方法测试，很难得到较好的处理效果，有很多肉眼都很容易看出的缺陷。</br></br>
而FALCON系统使用了基于仿真的局部梯度跟踪方法来处理配准，再通过多条件约束优化的方法处理融合，可以全自动无人工干预地获得更理想的影像。</br></br>
这里显示的是多种方法的结果比较：</br></br>
1）左上是PAN和MS分别做正射后直接融合（使用ENVI5.3上最新推出的效果最好的NNDIFFUSE）的结果。</br></br>
2）右上是正射后，通过ENVI的自动配准工具配准，然后再NNDIFFUSE融合的结果。</br></br>
3）左下是正射后，用ENVI的配准工具，先手工找30个控制点，然后再自动寻找50个控制点，利用80个控制点建立二阶多项式进行几何校正，然后再NNDIFFUSE融合的结果。</br></br>
4）右下是FALCON系统利用基于仿真的局部梯度追踪法配准，然后用多条件约束优化的融合方法，无人工干预全自动完成的结果。</br></br>
通过结果分析后可以看出，直接正射（方法1左上）后还有不少配准误差，ENVI自动配准（方法2右上）没有多少提高，人工找点（方法3左下）有明显的提高但是依然和FALCON（方法4右下）的结果有差距。</br></br>
除了配准的因素以外，融合的保真度也很重要，提醒一句大家中国人几乎没有屋顶是粉色的。</br></br>

</p>

		
	</div>
    <div class="col-md-5 ah nopadding">
		<div id="map1" class="map hh"></div>
		<div id="map3" class="map hh"></div>
	</div>
    <div class="col-md-5 ah nopadding">
		<div id="map2" class="map hh"></div>
		<div id="map4" class="map hh"></div>
	</div>
</div>
    <script>
    var extent = [0, 0, 512*16, 512*16];
    var projection = new ol.proj.Projection({
        code: 'xkcd-image',
        units: 'pixels',
        extent: extent
    });
	
	source1 = new ol.source.XYZ({
			    attributions: [
					new ol.Attribution({
						html: '正射 -> NNDiffuse融合'
					})
				],
              url: 'tiles/rpcOnly/{z}/{x}/{-y}.png',
			  projection: projection
            });
	source2 = new ol.source.XYZ({
			    attributions: [
					new ol.Attribution({
						html: '正射 -> ENVI自动配准 -> NNDiffuse融合'
					})
				],
              url: 'tiles/rpcAuto/{z}/{x}/{-y}.png',
			  projection: projection
            });
	source3 = new ol.source.XYZ({
			    attributions: [
					new ol.Attribution({
						html: '正射 -> ENVI手动找点配准 -> NNDiffuse融合'
					})
				],
              url: 'tiles/rpcManual/{z}/{x}/{-y}.png',
			  projection: projection
            });
	source4 = new ol.source.XYZ({
			    attributions: [
					new ol.Attribution({
						html: 'FALCON系统全自动完成'
					})
				],
              url: 'tiles/falcon/{z}/{x}/{-y}.png',
			  projection: projection
            });

	layer1 = new ol.layer.Tile({
        source: source1
    });

    layer2 = new ol.layer.Tile({
        source: source2
    });

    layer3 = new ol.layer.Tile({
        source: source3
    });

    layer4 = new ol.layer.Tile({
        source: source4
    });
	
    layer5 = new ol.layer.Tile({
        source: source4
    });

    view = new ol.View({
		projection: projection,
        center: [3500,3500],
        zoom: 5
    });
	
	var map1 = new ol.Map({
		target: 'map1',
		layers: [
			new ol.layer.Group({
				layers: [
					layer1,
					layer5
				]
			})
		],
		view: view
	});

	var map2 = new ol.Map({
		target: 'map2',
		layers: [
			new ol.layer.Group({
				layers: [
					layer2,
					layer5
				]
			})
		],
		view: view
	});

	var map3 = new ol.Map({
		target: 'map3',
		layers: [
			new ol.layer.Group({
				layers: [
					layer3,
					layer5
				]
			})
		],
		view: view
	});

	var map4 = new ol.Map({
		target: 'map4',
		layers: [
			new ol.layer.Group({
				layers: [
					layer4
				]
			})
		],
		view: view
	});

	layer5.setVisible(true);
	layer4.setVisible(true);
	layer1.setVisible(false);
	layer2.setVisible(false);
	layer3.setVisible(false);
	

	doFlip = true;
    setInterval('flipImage()', 1000);

    function flipImage() {
		if (doFlip)
		{
			if (layer5.getVisible())
			{
				layer1.setVisible(!layer1.getVisible());
				layer2.setVisible(!layer2.getVisible());
				layer3.setVisible(!layer3.getVisible());
				layer5.setVisible(!layer5.getVisible());
			}
			else
			{
				layer5.setVisible(!layer5.getVisible());
				layer1.setVisible(!layer1.getVisible());
				layer2.setVisible(!layer2.getVisible());
				layer3.setVisible(!layer3.getVisible());
			}
		}
    }

	function stopFlip()
	{
		doFlip = false;
		layer5.setVisible(false);
		layer4.setVisible(true);
		layer1.setVisible(true);
		layer2.setVisible(true);
		layer3.setVisible(true);
	}
	
	function runFlip()
	{
		doFlip = true;
	}
	
	var switchBtn = document.getElementById('switchFlipBtn');
    switchBtn.addEventListener('click', function() {	
		if (doFlip)
			stopFlip();
		else
			runFlip();
	});
	
    </script>
  </body>
</html>